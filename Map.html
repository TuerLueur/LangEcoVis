<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <!-- Load d3.js and the geo projection plugin -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
</head>

<!-- Create an element where the map will take place -->
<body>
<div id="my_dataviz"></div>
</body>


<style>
.Circle:hover{
    stroke: black;
    stroke-width: 1px;
}
.tooltip{
    opacity: 0;
    background-color: white;
    border: 1px solid;
    border-radius: 5px;
    padding: 3px;
    font-size: 3px;
    position: absolute;
}
</style>

<script>

    var width = 1080, height = 680
    // The svg
    var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

    // Map and projection
    var projection = d3.geoMercator()
        .center([0, 20])                // GPS of location to zoom on
        .scale(200)                       // This is like the zoom
        .translate([width / 2, height / 2])

    var path = d3.geoPath().projection(projection)

    var Tooltip = d3.select("#my_dataviz")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0)

    d3.queue()
        .defer(d3.json, "Data/countries.geojson") // dataGeo
        .defer(d3.csv, "Data/enhanceData/Lang.csv") // data: Position of circles
        // hoemlat, homelon, homecontinent, n
        .await(ready);

    // all tasks finished run ready

    function ready(error, dataGeo, data) {

        // Create a color scale
        var allContinent = d3.map(data, function (d) {
            return (d.Family_ID)
        }).keys()
        // return all keys(continent) list

        var color = d3.scaleOrdinal()
            // continent to color
            .domain(allContinent)
            .range([
                "#228B22", "#0401E3", "#FF4500", "#00FF00", "#20FF7F",
                "#FF6347", "#FF00FF", "#7CFC00", "#08A1FF", "#FFA500",
                "#FF5733", "#1E90FF", "#FFD700", "#8001BF", "#00CED1",
                "#1B0000", "#2FC0CB", "#3F69B4", "#C08080", "#A00080",
                "#8B0000", "#FFC0CB", "#FF69B4", "#F08080", "#000080",
                "#E9967A", "#FFB347", "#F0E68C", "#E6E6FA", "#7B68EE",
                "#008080", "#800080", "#FF1493", "#800F30", "#008000",
                "#FFB6C1", "#DC143C", "#8FBC8F", "#FFDAB9", "#4B0082",
                "#FF8C00", "#8070AD", "#87CEEB", "#ADFF2F", "#00FA9A",
            ]);

        let mouseOver = function (d) {
            Tooltip
                .style("opacity", 0.8)
        }

        let mouseMove = function (d) {
            Tooltip
                .html("Name: " + d.Name + "<br>" + "Family: " + d.Family_ID + "<br>" + "Language: " + d.Language_ID )
                .style("top", (event.layerY + 16) + "px")
                .style("left", (event.layerX + 16) + "px");
        }

        let mouseLeave = function (d) {
            Tooltip
                .style("opacity", 0)
        }

        // Draw the map

        svg.append("g")
            .selectAll("path")
            .data(dataGeo.features)
            .enter()
            .append("path")
            .attr("fill", "#b8b8b8")
            .attr("d", path)
            .attr("class", function(d) {return "Country"})
            .style("stroke", "#0099ff")
            .style("stroke-width", 0.5)
            .style("opacity", .3)
            // .on("mouseover", mouseOver )
            // .on("mousemove", mouseMove)
            // .on("mouseleave", mouseLeave )

        svg
            .selectAll("myCircles")
            .data(data)
            .enter()
            .append("circle")
                .attr("cx", function (d) {
                    return projection([+d.Lanlon, +d.Lanlat])[0]
                })
                .attr("cy", function (d) {
                    return projection([+d.Lanlon, +d.Lanlat])[1]
                })
                .attr("r", function (d) {
                    var temp = Math.sqrt(d.Population)
                    if (temp > 1)
                        return temp;
                    else
                        return 1;
                })
                .attr("class", function(d) {return "Circle"})
                .style("fill", function (d) {
                    return color(d.Family_ID)
                })
                .attr("stroke", "none")
                .attr("stroke-width", 1)
                .attr("fill-opacity", .4)
            .on("mouseover", mouseOver )
            .on("mousemove", mouseMove)
            .on("mouseleave", mouseLeave )

        // Add title and explanation
        svg
            .append("text")
            .attr("text-anchor", "end")
            .style("fill", "black")
            .attr("x", width)
            .attr("y", height - 30)
            .attr("width", 90)
            .html("Languages Distrubution Around the World")
            .style("font-size", 10)


        // --------------- //
        // ADD LEGEND //
        // --------------- //


        // Add legend: labels
        svg
            .selectAll("legend")
            .data(valuesToShow)
            .enter()
            .append("text")
            .attr('x', xLabel)
            .attr('y', function (d) {
                return height - size(d)
            })
            .text(function (d) {
                return d
            })
            .style("font-size", 10)
            .attr('alignment-baseline', 'middle')
    }

</script>